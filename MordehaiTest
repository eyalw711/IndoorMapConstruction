from matplotlib import pyplot as plt
from TrajectoryMaker import TrajectoryCollectionCSVLoader
import pandas as pd
from IMCObjects import GPoint, Fix, Trajectory
from geopy.distance import vincenty, VincentyDistance
from geopy.distance import Point as gpt
from shapely.geometry import Polygon, MultiPoint, LinearRing, LineString, MultiPolygon
from matplotlib import pyplot as plt
import random
import pandas as pd
from IMCObjects import GPoint, Fix, Trajectory
from Projector import EquirectangularProjector
import gmplot
from GoogleMapsTool import GoogleMapFactory,GoogleMapsConfig
from IMC_tests import main

def LoadRespondersCoords(filename):
    Coords = []
    data = pd.read_csv('data//' + filename + '.csv')
    for index, row in data.iterrows():
        Coords.append(GPoint(row['lat'], row['long']))
    return Coords


def PlotRespondersToGoogleMaps():
    l = LoadRespondersCoords("Respodenrs")
    Lat = [elem.getLat() for elem in l]
    Long = [elem.getLong() for elem in l]
    config = GoogleMapsConfig(Lat,Long,"RespondersFloor2.html")
    GoogleMapFactory.GenerateMap(config)


def main1():

    print("asdf")
    fig, axs = plt.subplots(1, 1)



    respondersGCoords = LoadRespondersCoords("RespodenrsFloor0")
    i = 0
    for point in respondersGCoords:
        i += 1
        print("{} {}".format(i, point))

    minLat = min(fix.getLat() for fix in respondersGCoords)
    maxLat = max(fix.getLat() for fix in respondersGCoords)
    minLong = min(fix.getLong() for fix in respondersGCoords)
    maxLong = max(fix.getLong() for fix in respondersGCoords)

    projector = EquirectangularProjector(None, False,(minLat,minLong), (maxLat,maxLong))
    X = []
    Y = []
    for fix in respondersGCoords:
        newX, newY = projector.latLongToXY(fix.getLat(),fix.getLong())
        X.append(newX)
        Y.append(newY)

    print(X)
    print(Y)

    print("Starting Reverse")

    RestoreLAT =[]
    RestoreLong =[]

    for x,y in zip(X,Y):
        lat, long = projector.XYToLatLong(x,y)
        point = GPoint(lat,long)
        print(point)
        RestoreLAT.append(lat)
        RestoreLong.append(long)

    LAT=[fix.getLat() for fix in respondersGCoords]
    LONG=[fix.getLong() for fix in respondersGCoords]

    axs.plot(X, Y, 'ro')

    gmap = gmplot.GoogleMapPlotter(LAT[0], LONG[0], 20)
    gmap.scatter(LAT, LONG, marker=False, size=0.5)
    gmap.draw("building_{}_GMAP.html".format(0))

    gmap = gmplot.GoogleMapPlotter(RestoreLAT[0], RestoreLong[0], 20)
    gmap.scatter(RestoreLAT, RestoreLong,marker=False,size=0.5)
    gmap.draw("building_{}_GMAP.html".format(0))

    print("END")
    plt.show()


if __name__ == "__main__":
    main()
    #PlotRespondersToGoogleMaps()